{
  "name": "ê°€ë§¹ì  ì¼ì¼ ë¦¬í¬íŠ¸ ìë™í™” (Gemini 2.5)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * *"
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "ë§¤ì¼ ì˜¤ì „ 9ì‹œ ì‹¤í–‰",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 0],
      "notes": "ë§¤ì¼ ì˜¤ì „ 9ì‹œì— ìë™ ì‹¤í–‰\nì–´ì œ ë§¤ì¶œ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ë¦¬í¬íŠ¸ ìƒì„±"
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "value": "1VnOc5BH_ORMEq7Km6sUd93VAnMFvHWK-UPtUlO-MYk0",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "ì§€ì A",
          "mode": "name"
        },
        "options": {
          "range": "A:AL"
        }
      },
      "id": "read-store-a",
      "name": "ì§€ì A ë°ì´í„°",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [220, -150],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "value": "1VnOc5BH_ORMEq7Km6sUd93VAnMFvHWK-UPtUlO-MYk0",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "ì§€ì B",
          "mode": "name"
        },
        "options": {
          "range": "A:AL"
        }
      },
      "id": "read-store-b",
      "name": "ì§€ì B ë°ì´í„°",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [220, -50],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "value": "1VnOc5BH_ORMEq7Km6sUd93VAnMFvHWK-UPtUlO-MYk0",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "ì§€ì C",
          "mode": "name"
        },
        "options": {
          "range": "A:AL"
        }
      },
      "id": "read-store-c",
      "name": "ì§€ì C ë°ì´í„°",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [220, 50],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "value": "1VnOc5BH_ORMEq7Km6sUd93VAnMFvHWK-UPtUlO-MYk0",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "ì§€ì D",
          "mode": "name"
        },
        "options": {
          "range": "A:AL"
        }
      },
      "id": "read-store-d",
      "name": "ì§€ì D ë°ì´í„°",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [220, 150],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "id": "merge-all-data",
      "name": "ì „ì²´ ë°ì´í„° ë³‘í•©",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [440, 0]
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// ê°€ë§¹ì  ì¼ì¼ ë¦¬í¬íŠ¸ - ê³ ê¸‰ ë¶„ì„ ì½”ë“œ\n// ============================================\n\nconst CONFIG = {\n  inventory: {\n    bean: { warning: 3, critical: 1.5 },\n    milk: { warning: 4, critical: 2 },\n    syrup: { warning: 4, critical: 2 },\n    cup: { warning: 200, critical: 100 }\n  },\n  performance: {\n    salesGrowthTarget: 5,\n    revisitRateTarget: 40,\n    wasteRateLimit: 3,\n    productivityTarget: 400000\n  }\n};\n\n// ë‚ ì§œ ìœ í‹¸ë¦¬í‹°\nconst formatDate = (date) => date.toISOString().split('T')[0];\n\nconst getDateRange = () => {\n  const today = new Date();\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n  \n  const dayBefore = new Date(yesterday);\n  dayBefore.setDate(dayBefore.getDate() - 1);\n  \n  const weekAgo = new Date(yesterday);\n  weekAgo.setDate(weekAgo.getDate() - 7);\n  \n  const monthAgo = new Date(yesterday);\n  monthAgo.setDate(monthAgo.getDate() - 30);\n  \n  return {\n    today: formatDate(today),\n    yesterday: formatDate(yesterday),\n    dayBefore: formatDate(dayBefore),\n    weekAgo: formatDate(weekAgo),\n    monthAgo: formatDate(monthAgo)\n  };\n};\n\n// ë°ì´í„° í•„í„°ë§\nconst filterByDate = (data, dateStr) => data.filter(r => r['ë‚ ì§œ'] === dateStr);\nconst filterByDateRange = (data, startDate, endDate) => \n  data.filter(r => r['ë‚ ì§œ'] >= startDate && r['ë‚ ì§œ'] <= endDate);\n\n// í†µê³„ í•¨ìˆ˜\nconst sum = (arr, key) => arr.reduce((acc, r) => acc + (parseInt(r[key]) || 0), 0);\nconst avg = (arr, key) => arr.length ? sum(arr, key) / arr.length : 0;\nconst calcChangeRate = (current, previous) => \n  previous ? ((current - previous) / previous * 100).toFixed(1) : 0;\n\n// ì…ë ¥ ë°ì´í„°\nconst allData = $input.all().map(item => item.json);\nconst dates = getDateRange();\n\n// ë°ì´í„° í•„í„°ë§\nconst todayData = filterByDate(allData, dates.yesterday);\nconst yesterdayData = filterByDate(allData, dates.dayBefore);\nconst weekData = filterByDateRange(allData, dates.weekAgo, dates.yesterday);\nconst monthData = filterByDateRange(allData, dates.monthAgo, dates.yesterday);\n\nif (todayData.length === 0) {\n  return [{ json: { error: true, message: `${dates.yesterday} ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.` }}];\n}\n\n// ë§¤ì¶œ ë¶„ì„\nconst todaySales = sum(todayData, 'ì´ë§¤ì¶œ');\nconst yesterdaySales = sum(yesterdayData, 'ì´ë§¤ì¶œ');\nconst salesChange = calcChangeRate(todaySales, yesterdaySales);\n\n// ì§€ì ë³„ ë¶„ì„\nconst storeAnalysis = todayData.map(store => {\n  const prevStore = yesterdayData.find(y => y['ì§€ì ì½”ë“œ'] === store['ì§€ì ì½”ë“œ']);\n  const prevSales = prevStore ? parseInt(prevStore['ì´ë§¤ì¶œ']) : 0;\n  const storeSales = parseInt(store['ì´ë§¤ì¶œ']) || 0;\n  \n  return {\n    name: store['ê°€ë§¹ì ëª…'],\n    code: store['ì§€ì ì½”ë“œ'],\n    sales: storeSales,\n    salesFormatted: storeSales.toLocaleString(),\n    change: calcChangeRate(storeSales, prevSales),\n    customers: parseInt(store['ì´ê³ ê°ìˆ˜']) || 0,\n    avgTicket: parseInt(store['ê°ë‹¨ê°€']) || 0,\n    americano: parseInt(store['ì•„ë©”ë¦¬ì¹´ë…¸']) || 0,\n    latte: parseInt(store['ì¹´í˜ë¼ë–¼']) || 0,\n    newMenu: parseInt(store['ì‹ ë©”ë‰´']) || 0,\n    beanStock: parseFloat(store['ì›ë‘ì¬ê³ (kg)']) || 0,\n    milkStock: parseInt(store['ìš°ìœ ì¬ê³ (ë°•ìŠ¤)']) || 0,\n    staffCount: parseInt(store['ê·¼ë¬´ì¸ì›']) || 1,\n    productivity: Math.round(storeSales / (parseInt(store['ê·¼ë¬´ì¸ì›']) || 1)),\n    waste: parseInt(store['íê¸°ëŸ‰(ì”)']) || 0,\n    weather: store['ë‚ ì”¨'],\n    event: store['íŠ¹ì´ì‚¬í•­'] || ''\n  };\n}).sort((a, b) => b.sales - a.sales);\n\n// ì¬ê³  ì•Œë¦¼ ìƒì„±\nconst inventoryAlerts = [];\nstoreAnalysis.forEach(store => {\n  if (store.beanStock <= CONFIG.inventory.bean.critical) {\n    inventoryAlerts.push(`ğŸš¨ ${store.name}: ì›ë‘ ê¸´ê¸‰ ë°œì£¼ (${store.beanStock}kg)`);\n  } else if (store.beanStock <= CONFIG.inventory.bean.warning) {\n    inventoryAlerts.push(`âš ï¸ ${store.name}: ì›ë‘ ë°œì£¼ í•„ìš” (${store.beanStock}kg)`);\n  }\n  if (store.milkStock <= CONFIG.inventory.milk.critical) {\n    inventoryAlerts.push(`ğŸš¨ ${store.name}: ìš°ìœ  ê¸´ê¸‰ ë°œì£¼ (${store.milkStock}ë°•ìŠ¤)`);\n  } else if (store.milkStock <= CONFIG.inventory.milk.warning) {\n    inventoryAlerts.push(`âš ï¸ ${store.name}: ìš°ìœ  ë°œì£¼ í•„ìš” (${store.milkStock}ë°•ìŠ¤)`);\n  }\n});\n\n// ë©”ë‰´ë³„ ë¶„ì„\nconst menuSales = {\n  americano: sum(todayData, 'ì•„ë©”ë¦¬ì¹´ë…¸'),\n  latte: sum(todayData, 'ì¹´í˜ë¼ë–¼'),\n  vanillaLatte: sum(todayData, 'ë°”ë‹ë¼ë¼ë–¼'),\n  coldBrew: sum(todayData, 'ì½œë“œë¸Œë£¨'),\n  nonCoffee: sum(todayData, 'ë…¼ì»¤í”¼ìŒë£Œ'),\n  newMenu: sum(todayData, 'ì‹ ë©”ë‰´')\n};\n\nconst totalDrinks = Object.values(menuSales).reduce((a, b) => a + b, 0);\n\n// ì£¼ê°„ íŠ¸ë Œë“œ\nconst weeklyTrend = [];\nfor (let i = 6; i >= 0; i--) {\n  const d = new Date();\n  d.setDate(d.getDate() - i - 1);\n  const dateStr = formatDate(d);\n  const dayData = filterByDate(allData, dateStr);\n  weeklyTrend.push({\n    date: dateStr.slice(5),\n    sales: sum(dayData, 'ì´ë§¤ì¶œ')\n  });\n}\n\n// ì¸ì‚¬ì´íŠ¸ ìƒì„±\nconst insights = [];\nconst recommendations = [];\n\nif (parseFloat(salesChange) > 10) {\n  insights.push(`ğŸ“ˆ ì „ì¼ ëŒ€ë¹„ ë§¤ì¶œ ${salesChange}% ìƒìŠ¹`);\n} else if (parseFloat(salesChange) < -10) {\n  insights.push(`ğŸ“‰ ì „ì¼ ëŒ€ë¹„ ë§¤ì¶œ ${salesChange}% í•˜ë½`);\n  recommendations.push('ë§¤ì¶œ í•˜ë½ ì›ì¸ ë¶„ì„ í•„ìš”');\n}\n\nconst topStore = storeAnalysis[0];\nconst bottomStore = storeAnalysis[storeAnalysis.length - 1];\ninsights.push(`ğŸ† ìµœê³  ë§¤ì¶œ: ${topStore.name} (${topStore.salesFormatted}ì›)`);\n\nif (menuSales.newMenu > 0) {\n  const newMenuRatio = ((menuSales.newMenu / totalDrinks) * 100).toFixed(1);\n  insights.push(`âœ¨ ì‹ ë©”ë‰´ íŒë§¤ ${menuSales.newMenu}ì” (ì „ì²´ ${newMenuRatio}%)`);\n}\n\nreturn [{\n  json: {\n    date: dates.yesterday,\n    summary: {\n      totalSales: todaySales.toLocaleString(),\n      salesChange: `${parseFloat(salesChange) >= 0 ? '+' : ''}${salesChange}%`,\n      totalCustomers: sum(todayData, 'ì´ê³ ê°ìˆ˜'),\n      avgTicket: Math.round(avg(todayData, 'ê°ë‹¨ê°€')).toLocaleString(),\n      storeCount: todayData.length\n    },\n    stores: storeAnalysis,\n    menu: menuSales,\n    totalDrinks,\n    weeklyTrend,\n    inventoryAlerts,\n    insights,\n    recommendations\n  }\n}];"
      },
      "id": "analyze-data",
      "name": "ë°ì´í„° ë¶„ì„",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 0],
      "notes": "ë§¤ì¶œ/ê³ ê°/ë©”ë‰´/ì¬ê³  ì¢…í•© ë¶„ì„\nê²½í–¥ íŒŒì•… ë° ì¸ì‚¬ì´íŠ¸ ìƒì„±"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "Gemini 2.5 Flash"
        },
        "messages": {
          "values": [
            {
              "content": "ë‹¹ì‹ ì€ í”„ëœì°¨ì´ì¦ˆ ì¹´í˜ ë³¸ì‚¬ì˜ ë°ì´í„° ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\nì•„ë˜ ë¶„ì„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê²½ì˜ì§„ì´ ë¹ ë¥´ê²Œ ì˜ì‚¬ê²°ì •í•  ìˆ˜ ìˆëŠ” ì¼ì¼ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.\n\n## ë¶„ì„ ë°ì´í„°\në‚ ì§œ: {{ $json.date }}\n\n### ë§¤ì¶œ ìš”ì•½\n- ì´ ë§¤ì¶œ: {{ $json.summary.totalSales }}ì›\n- ì „ì¼ ëŒ€ë¹„: {{ $json.summary.salesChange }}\n- ì´ ê³ ê°ìˆ˜: {{ $json.summary.totalCustomers }}ëª…\n- ê°ë‹¨ê°€: {{ $json.summary.avgTicket }}ì›\n- ìš´ì˜ ë§¤ì¥: {{ $json.summary.storeCount }}ê°œ\n\n### ì§€ì ë³„ ì‹¤ì \n{{ JSON.stringify($json.stores, null, 2) }}\n\n### ë©”ë‰´ íŒë§¤ëŸ‰\n{{ JSON.stringify($json.menu, null, 2) }}\n\n### ì£¼ê°„ ë§¤ì¶œ ì¶”ì´\n{{ JSON.stringify($json.weeklyTrend, null, 2) }}\n\n### ì¬ê³  ì•Œë¦¼\n{{ $json.inventoryAlerts.join('\\n') }}\n\n### ì¸ì‚¬ì´íŠ¸\n{{ $json.insights.join('\\n') }}\n\n### ê¶Œê³ ì‚¬í•­\n{{ $json.recommendations.join('\\n') }}\n\n## ë¦¬í¬íŠ¸ í˜•ì‹\n\n```\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“Š [ë‚ ì§œ] ê°€ë§¹ì  ì¼ì¼ ë¦¬í¬íŠ¸\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ’° ë§¤ì¶œ í˜„í™©\n  - ì´ ë§¤ì¶œ: Xì› (ì „ì¼ ëŒ€ë¹„ X%)\n  - ê³ ê°ìˆ˜: Xëª… | ê°ë‹¨ê°€: Xì›\n\nğŸª ì§€ì ë³„ ìˆœìœ„\n  1ï¸âƒ£ [ì§€ì ëª…] Xì› (+X%)\n  2ï¸âƒ£ [ì§€ì ëª…] Xì› (+X%)\n  3ï¸âƒ£ [ì§€ì ëª…] Xì› (-X%)\n  4ï¸âƒ£ [ì§€ì ëª…] Xì› (-X%)\n\nâ˜• ë² ìŠ¤íŠ¸ ë©”ë‰´\n  - ì•„ë©”ë¦¬ì¹´ë…¸ Xì” (X%)\n  - ì¹´í˜ë¼ë–¼ Xì” (X%)\n\nğŸ“¦ ì¬ê³  ì•Œë¦¼\n  [ìˆìœ¼ë©´ í‘œì‹œ]\n\nğŸ“ˆ ì£¼ê°„ íŠ¸ë Œë“œ\n  [ê°„ë‹¨í•œ ì¶”ì„¸ ì„¤ëª…]\n\nğŸ’¡ ì˜¤ëŠ˜ì˜ ì¸ì‚¬ì´íŠ¸\n  [í•µì‹¬ 1-2ê°œ]\n\nğŸ¯ ì•¡ì…˜ ì•„ì´í…œ\n  [êµ¬ì²´ì  ì¡°ì¹˜ì‚¬í•­]\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n```\n\ní…”ë ˆê·¸ë¨/ì¹´ì¹´ì˜¤í†¡ì— ì í•©í•˜ê²Œ ì´ëª¨ì§€ í™œìš©í•˜ì—¬ ê°€ë…ì„± ìˆê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”."
            }
          ]
        },
        "options": {
          "temperature": 0.7,
          "maxOutputTokens": 1500
        }
      },
      "id": "generate-report-gemini",
      "name": "Gemini ë¦¬í¬íŠ¸ ìƒì„±",
      "type": "n8n-nodes-base.googleGemini",
      "typeVersion": 1,
      "position": [880, 0],
      "credentials": {
        "googleAi": {
          "id": "YOUR_GOOGLE_AI_CREDENTIAL_ID",
          "name": "Google AI (Gemini)"
        }
      },
      "notes": "Gemini 2.5 Flash ì‚¬ìš©\në¹„ìš©: $0.10/1M tokens (GPT ëŒ€ë¹„ 33% ì €ë ´)"
    },
    {
      "parameters": {
        "chatId": "YOUR_TELEGRAM_CHAT_ID",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "send-telegram",
      "name": "í…”ë ˆê·¸ë¨ ë°œì†¡",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1100, -50],
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram"
        }
      }
    },
    {
      "parameters": {
        "url": "https://YOUR_KAKAO_WEBHOOK_URL",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "={{ $json.output }}"
            }
          ]
        },
        "options": {}
      },
      "id": "send-kakao",
      "name": "ì¹´ì¹´ì˜¤í†¡ ë°œì†¡ (ì„ íƒ)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 50],
      "notes": "ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ API ë˜ëŠ” ì›¹í›… ì‚¬ìš©\nì„ íƒì ìœ¼ë¡œ ì—°ê²°"
    }
  ],
  "connections": {
    "ë§¤ì¼ ì˜¤ì „ 9ì‹œ ì‹¤í–‰": {
      "main": [
        [
          { "node": "ì§€ì A ë°ì´í„°", "type": "main", "index": 0 },
          { "node": "ì§€ì B ë°ì´í„°", "type": "main", "index": 0 },
          { "node": "ì§€ì C ë°ì´í„°", "type": "main", "index": 0 },
          { "node": "ì§€ì D ë°ì´í„°", "type": "main", "index": 0 }
        ]
      ]
    },
    "ì§€ì A ë°ì´í„°": {
      "main": [
        [{ "node": "ì „ì²´ ë°ì´í„° ë³‘í•©", "type": "main", "index": 0 }]
      ]
    },
    "ì§€ì B ë°ì´í„°": {
      "main": [
        [{ "node": "ì „ì²´ ë°ì´í„° ë³‘í•©", "type": "main", "index": 0 }]
      ]
    },
    "ì§€ì C ë°ì´í„°": {
      "main": [
        [{ "node": "ì „ì²´ ë°ì´í„° ë³‘í•©", "type": "main", "index": 0 }]
      ]
    },
    "ì§€ì D ë°ì´í„°": {
      "main": [
        [{ "node": "ì „ì²´ ë°ì´í„° ë³‘í•©", "type": "main", "index": 0 }]
      ]
    },
    "ì „ì²´ ë°ì´í„° ë³‘í•©": {
      "main": [
        [{ "node": "ë°ì´í„° ë¶„ì„", "type": "main", "index": 0 }]
      ]
    },
    "ë°ì´í„° ë¶„ì„": {
      "main": [
        [{ "node": "Gemini ë¦¬í¬íŠ¸ ìƒì„±", "type": "main", "index": 0 }]
      ]
    },
    "Gemini ë¦¬í¬íŠ¸ ìƒì„±": {
      "main": [
        [
          { "node": "í…”ë ˆê·¸ë¨ ë°œì†¡", "type": "main", "index": 0 },
          { "node": "ì¹´ì¹´ì˜¤í†¡ ë°œì†¡ (ì„ íƒ)", "type": "main", "index": 0 }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Seoul"
  },
  "staticData": null,
  "tags": ["í”„ëœì°¨ì´ì¦ˆ", "ì¼ì¼ë¦¬í¬íŠ¸", "ìë™í™”", "Gemini"],
  "triggerCount": 1,
  "pinData": {}
}
